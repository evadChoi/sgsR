<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>stratification • sgsR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="stratification">
<meta property="og:description" content="Learn how to use strat* functions.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sgsR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/sgsR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calculating.html">calculating</a>
    </li>
    <li>
      <a href="../articles/sampling.html">sampling</a>
    </li>
    <li>
      <a href="../articles/stratification.html">stratification</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>stratification</h1>
            
      
      
      <div class="hidden name"><code>stratification.Rmd</code></div>

    </div>

    
    
<div class="section level1 unnumbered">
<h1 class="unnumbered" id="strat">
<code>strat_*</code> functions<a class="anchor" aria-label="anchor" href="#strat"></a>
</h1>
<p>Fundamental to many structurally guided sampling approaches is the use of stratification methods that allow for more effective and representative sampling protocols. Below I define the stratification methods that are included thus far in <code>sgsR</code> and provide some worked examples for each.</p>
<p>A total of 6 <code>strat</code> functions currently exist in the package:</p>
<ul>
<li><p><code><a href="../reference/strat_kmeans.html">strat_kmeans()</a></code> - kmeans stratification</p></li>
<li><p><code><a href="../reference/strat_pcomp.html">strat_pcomp()</a></code>- principal component stratification</p></li>
<li><p><code><a href="../reference/strat_breaks.html">strat_breaks()</a></code> - user-defined break stratification</p></li>
<li><p><code><a href="../reference/strat_osb.html">strat_osb()</a></code> - optimum sample boundary stratification</p></li>
<li><p><code><a href="../reference/strat_poly.html">strat_poly()</a></code> - polygon attribute stratification</p></li>
<li><p><code><a href="../reference/strat_map.html">strat_map()</a></code> - maps (combines) 2 stratification</p></li>
</ul>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="kmeans">
<code>strat_kmeans</code><a class="anchor" aria-label="anchor" href="#kmeans"></a>
</h2>
<p>We provide a preliminary example of the <code><a href="../reference/strat_kmeans.html">strat_kmeans()</a></code> algorithm to prepare our <code>sraster</code> input data but here are a few more.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--- perform stratification using k-means ---#</span>
<span class="fu"><a href="../reference/strat_kmeans.html">strat_kmeans</a></span><span class="op">(</span>mraster <span class="op">=</span> <span class="va">mraster</span>, <span class="co"># input</span>
             nStrata <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># algorithm will produce 4 strata</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 277, 373, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 20, 20  (x, y)</span>
<span class="co">#&gt; extent      : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; name        : strata </span>
<span class="co">#&gt; min value   :      1 </span>
<span class="co">#&gt; max value   :      5</span></code></pre></div>
<p>Notice that nothing plotted… That’s because <code>plot = FALSE</code> is the default for all functions in <code>sgsR</code>. See examples below where <code>plot = TRUE</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/strat_kmeans.html">strat_kmeans</a></span><span class="op">(</span>mraster <span class="op">=</span> <span class="va">mraster</span>, <span class="co"># input</span>
             nStrata <span class="op">=</span> <span class="fl">10</span>, <span class="co"># algorithm will produce 10 strata</span>
             iter <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># set minimum number of iterations to determine kmeans centers</span>
             algorithm <span class="op">=</span> <span class="st">"MacQueen"</span>, <span class="co"># use MacQueen algorithm</span>
             plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># plot output</span></code></pre></div>
<p><img src="stratification_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<pre><code><span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 277, 373, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 20, 20  (x, y)</span>
<span class="co">#&gt; extent      : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; name        : strata </span>
<span class="co">#&gt; min value   :      1 </span>
<span class="co">#&gt; max value   :     10</span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/strat_kmeans.html">strat_kmeans</a></span><span class="op">(</span>mraster <span class="op">=</span> <span class="va">mraster</span>, <span class="co"># input</span>
             nStrata <span class="op">=</span> <span class="fl">5</span>, <span class="co"># algorithm will produce 4 strata</span>
             center <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># do not center data</span>
             scale <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># do not scale data</span>
             plot <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># plot output</span>
             filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span>, <span class="co"># write output sraster to file</span>
             overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># overwrite file on disc if it exists</span></code></pre></div>
<p><img src="stratification_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<pre><code><span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 277, 373, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 20, 20  (x, y)</span>
<span class="co">#&gt; extent      : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; name        : strata </span>
<span class="co">#&gt; min value   :      1 </span>
<span class="co">#&gt; max value   :      5</span></code></pre>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="strat_pcomp">
<code>strat_pcomp</code><a class="anchor" aria-label="anchor" href="#strat_pcomp"></a>
</h2>
<p>The <code><a href="../reference/strat_pcomp.html">strat_pcomp()</a></code> algorithm calculates principal components on the input <code>mraster</code> then divides data into equal sized strata. Strata can be defined by using the primary (PC1) only (<code>nStrata</code>), or primary &amp; secondary (PC2 - <code>nStata2</code>) principal components. If <code>nStata2</code> is defined, PC2 is used and the total number of strata will be <span class="math display">\[nStrata * nStrata2\]</span>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--- perform stratification using principal components ---#</span>
<span class="fu"><a href="../reference/strat_pcomp.html">strat_pcomp</a></span><span class="op">(</span>mraster <span class="op">=</span> <span class="va">mraster</span>, <span class="co"># input</span>
            nStrata <span class="op">=</span> <span class="fl">5</span>, <span class="co"># 5 strata with primary PC only</span>
            plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># plot</span></code></pre></div>
<p><img src="stratification_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<pre><code><span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 277, 373, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 20, 20  (x, y)</span>
<span class="co">#&gt; extent      : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; name        : strata </span>
<span class="co">#&gt; min value   :      1 </span>
<span class="co">#&gt; max value   :      5</span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/strat_pcomp.html">strat_pcomp</a></span><span class="op">(</span>mraster <span class="op">=</span> <span class="va">mraster</span>, <span class="co"># input</span>
            nStrata <span class="op">=</span> <span class="fl">4</span>, <span class="co"># 4 strata with primary</span>
            nStrata2 <span class="op">=</span> <span class="fl">4</span>, <span class="co"># 4 strata with secondary PC - will produce 16 output strata</span>
            plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># produce output details</span></code></pre></div>
<p><img src="stratification_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<pre><code><span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 277, 373, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 20, 20  (x, y)</span>
<span class="co">#&gt; extent      : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; name        : strata </span>
<span class="co">#&gt; min value   :      1 </span>
<span class="co">#&gt; max value   :     16</span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/strat_pcomp.html">strat_pcomp</a></span><span class="op">(</span>mraster <span class="op">=</span> <span class="va">mraster</span>, <span class="co"># input</span>
            nStrata <span class="op">=</span> <span class="fl">3</span>, <span class="co"># 3 strata with primary PC</span>
            nStrata2 <span class="op">=</span> <span class="fl">3</span>, <span class="co"># 4 strata with secondary PC - will produce 9 output strata</span>
            filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span> <span class="co"># write output sraster to file</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 277, 373, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 20, 20  (x, y)</span>
<span class="co">#&gt; extent      : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; name        : strata </span>
<span class="co">#&gt; min value   :      1 </span>
<span class="co">#&gt; max value   :      9</span></code></pre></div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="strat_breaks">
<code>strat_breaks</code><a class="anchor" aria-label="anchor" href="#strat_breaks"></a>
</h2>
<p>The <code><a href="../reference/strat_breaks.html">strat_breaks()</a></code> function stratifies data based on user-defined breaks in covariates. A single <code>metric</code> can be defined or an additional <code>metric2</code> can be supplied. <code>breaks</code> and <code>breaks2</code> correspond to the user-defined breaks for <code>metric</code> and <code>metric2</code> respectively.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--- perform stratification using user-defined breaks ---#</span>

<span class="co">#--- define breaks for metric ---#</span>
<span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span>

<span class="va">breaks</span>
<span class="co">#&gt; [1]   0  20  40  60  80 100</span>

<span class="co">#--- perform stratification using user-defined breaks ---#</span>

<span class="va">values</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">mraster</span><span class="op">$</span><span class="va">zmax</span><span class="op">)</span>

<span class="co">#--- define breaks for metric ---#</span>
<span class="va">breaks2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">values</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">breaks2</span>
<span class="co">#&gt;    0%   25%   50%   75%  100% </span>
<span class="co">#&gt;  0.00  5.62  9.07 12.16 23.82</span></code></pre></div>
<p>Once the breaks have been created we can input them into the function using the <code>breaks</code> and <code>breaks2</code> parameters.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--- stratify on 1 metric only ---#</span>

<span class="fu"><a href="../reference/strat_breaks.html">strat_breaks</a></span><span class="op">(</span>mraster <span class="op">=</span> <span class="va">mraster</span><span class="op">$</span><span class="va">zmean</span>,
             breaks <span class="op">=</span> <span class="va">breaks</span>,
             details <span class="op">=</span> <span class="cn">TRUE</span>,
             plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="stratification_files/figure-html/unnamed-chunk-10-1.png" width="700"><img src="stratification_files/figure-html/unnamed-chunk-10-2.png" width="700"></p>
<pre><code><span class="co">#&gt; $details</span>
<span class="co">#&gt; $details$breaks</span>
<span class="co">#&gt; [1]   0  20  40  60  80 100</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $details$breaks2</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $raster</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 277, 373, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 20, 20  (x, y)</span>
<span class="co">#&gt; extent      : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; name        : strata </span>
<span class="co">#&gt; min value   :      2 </span>
<span class="co">#&gt; max value   :      7 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $plot</span></code></pre>
<p><img src="stratification_files/figure-html/unnamed-chunk-10-3.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--- stratify on 1 metric only ---#</span>

<span class="fu"><a href="../reference/strat_breaks.html">strat_breaks</a></span><span class="op">(</span>mraster <span class="op">=</span> <span class="va">mraster</span><span class="op">$</span><span class="va">zmax</span>,
             breaks <span class="op">=</span> <span class="va">breaks2</span>,
             details <span class="op">=</span> <span class="cn">TRUE</span>,
             plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="stratification_files/figure-html/unnamed-chunk-11-1.png" width="700"><img src="stratification_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
<pre><code><span class="co">#&gt; $details</span>
<span class="co">#&gt; $details$breaks</span>
<span class="co">#&gt;    0%   25%   50%   75%  100% </span>
<span class="co">#&gt;  0.00  5.62  9.07 12.16 23.82 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $details$breaks2</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $raster</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 277, 373, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 20, 20  (x, y)</span>
<span class="co">#&gt; extent      : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; name        : strata </span>
<span class="co">#&gt; min value   :      2 </span>
<span class="co">#&gt; max value   :      6 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $plot</span></code></pre>
<p><img src="stratification_files/figure-html/unnamed-chunk-11-3.png" width="700"></p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="strat_osb">
<code>strat_osb</code><a class="anchor" aria-label="anchor" href="#strat_osb"></a>
</h2>
<p>The <code><a href="../reference/strat_osb.html">strat_osb()</a></code> algorithm implements the optimum sample boundaries algorithm implmented in the <code>stratifyR</code> package. The basics of this algorithm are to provide the number of desired strata <code>nStrata</code> and samples <code>nSamp</code>. The algorithm then analyzes the data for the optimal locations to establish breaks in the covariate <code>metric</code>, which are used as stratum boundaries.</p>
<p>This function can take a bit longer to run so please be patient! For the purpses of this example I have used a limited number of <code>nStrata</code> and <code>nSamp</code> to ensure they run and render quickly.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--- perform optimum sample boundary stratification ---#</span>
<span class="fu"><a href="../reference/strat_osb.html">strat_osb</a></span><span class="op">(</span>mraster <span class="op">=</span> <span class="va">mraster</span><span class="op">$</span><span class="va">zsd</span>, <span class="co"># input</span>
            nSamp <span class="op">=</span> <span class="fl">50</span>, <span class="co"># number of desired samples</span>
            nStrata <span class="op">=</span> <span class="fl">3</span>, <span class="co"># number of desired strata</span>
            plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># plot</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/strat_osb.html">strat_osb</a></span><span class="op">(</span>mraster <span class="op">=</span> <span class="va">mraster</span><span class="op">$</span><span class="va">zmax</span>, <span class="co"># input</span>
            nSamp <span class="op">=</span> <span class="fl">25</span>, <span class="co"># number of desired samples</span>
            nStrata <span class="op">=</span> <span class="fl">3</span>, <span class="co"># number of desired strata</span>
            plot <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># plot</span>
            details <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># produce output details</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/strat_osb.html">strat_osb</a></span><span class="op">(</span>mraster <span class="op">=</span> <span class="va">mraster</span><span class="op">$</span><span class="va">zmax</span>, <span class="co"># input</span>
            nSamp <span class="op">=</span> <span class="fl">50</span>, <span class="co"># number of desired samples</span>
            nStrata <span class="op">=</span> <span class="fl">3</span>, <span class="co"># number of desired strata</span>
            subset <span class="op">=</span> <span class="fl">0.75</span>, <span class="co"># used a subset of covariate data to determine optimum breaks</span>
            filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span> <span class="co"># write output sraster to file</span></code></pre></div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="strat_poly">
<code>strat_poly</code><a class="anchor" aria-label="anchor" href="#strat_poly"></a>
</h2>
<p>The <code><a href="../reference/strat_poly.html">strat_poly()</a></code> algorithm stratifies based on spatial polygon attributes and features. A user may wish to stratify based on categorical or empirical variables that are not given by ALS data (e.g. species from forest inventory polygons). This method allows the user to define the attribute of interest as well as how features within attributes should be grouped for stratification.</p>
<p>The user defines the input <code>poly</code> and associated <code>attribute</code>. A <code>raster</code> layer must be provided as a guide for spatial extent and resolution for the output stratification polygon. Based on a vector or list of <code>features</code>, stratification is applied, and the polygon is rasterized into appropriate strata.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--- load in polygon coverage ---#</span>
<span class="va">poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"inventory_polygons.shp"</span>, package <span class="op">=</span> <span class="st">"sgsR"</span><span class="op">)</span>

<span class="va">fri</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">poly</span><span class="op">)</span>
<span class="co">#&gt; Reading layer `inventory_polygons' from data source </span>
<span class="co">#&gt;   `C:\Users\tgood.stu\Documents\R\win-library\4.1\sgsR\extdata\inventory_polygons.shp' </span>
<span class="co">#&gt;   using driver `ESRI Shapefile'</span>
<span class="co">#&gt; Simple feature collection with 632 features and 3 fields</span>
<span class="co">#&gt; Geometry type: MULTIPOLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 431100 ymin: 5337700 xmax: 438560 ymax: 5343240</span>
<span class="co">#&gt; Projected CRS: UTM_Zone_17_Northern_Hemisphere</span></code></pre></div>
<p>The <code>attribute</code> column must be defined, while the <code>features</code> within must be specified to define the number and composition of the output strata. In the case below the <code>attribute = "NUTRIENTS"</code> and features within <code>NUTRIENTS</code> (poor, rich, medium) will define the 3 desired output classes.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--- stratify polygon coverage ---#</span>
<span class="co">#--- specify polygon attribute to stratify ---#</span>

<span class="va">attribute</span> <span class="op">&lt;-</span> <span class="st">"NUTRIENTS"</span>

<span class="co">#--- specify features within attribute &amp; how they should be grouped ---#</span>
<span class="co">#--- as a single vector ---#</span>

<span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poor"</span>, <span class="st">"rich"</span>, <span class="st">"medium"</span><span class="op">)</span>

<span class="va">srasterpoly</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/strat_poly.html">strat_poly</a></span><span class="op">(</span>poly <span class="op">=</span> <span class="va">fri</span>, <span class="co"># input polygon</span>
                          attribute <span class="op">=</span> <span class="va">attribute</span>, <span class="co"># attribute to stratify by</span>
                          features <span class="op">=</span> <span class="va">features</span>, <span class="co"># features within attribute</span>
                          raster <span class="op">=</span> <span class="va">sraster</span>, <span class="co"># raster to define extent and resolution for output</span>
                          plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># plot output</span></code></pre></div>
<p><img src="stratification_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p><code>features</code> can also be made to amalgamate classes. In the example below <code>rich</code> and <code>medium</code> features are combined while <code>low</code> is left alone. The 2 vectors are then added to a list, which outputs 2 classes (low &amp; rich/medium).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--- or as multiple lists ---#</span>
<span class="va">g1</span> <span class="op">&lt;-</span> <span class="st">"poor"</span>
<span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rich"</span>, <span class="st">"medium"</span><span class="op">)</span>

<span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span><span class="op">)</span>

<span class="fu"><a href="../reference/strat_poly.html">strat_poly</a></span><span class="op">(</span>poly <span class="op">=</span> <span class="va">fri</span>,
           attribute <span class="op">=</span> <span class="va">attribute</span>,
           features <span class="op">=</span> <span class="va">features</span>,
           raster <span class="op">=</span> <span class="va">sraster</span>,
           plot <span class="op">=</span> <span class="cn">TRUE</span>,
           details <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="stratification_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<pre><code><span class="co">#&gt; $outRaster</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 277, 373, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 20, 20  (x, y)</span>
<span class="co">#&gt; extent      : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; name        : strata </span>
<span class="co">#&gt; min value   :      1 </span>
<span class="co">#&gt; max value   :      2 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $lookUp</span>
<span class="co">#&gt;   strata features</span>
<span class="co">#&gt; 1      1     poor</span>
<span class="co">#&gt; 2      2     rich</span>
<span class="co">#&gt; 3      2   medium</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $poly</span>
<span class="co">#&gt;  class       : SpatVector </span>
<span class="co">#&gt;  geometry    : polygons </span>
<span class="co">#&gt;  dimensions  : 524, 2  (geometries, attributes)</span>
<span class="co">#&gt;  extent      : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt;  coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +units=m +no_defs </span>
<span class="co">#&gt;  names       : NUTRIENTS strata</span>
<span class="co">#&gt;  type        :     &lt;chr&gt;  &lt;num&gt;</span>
<span class="co">#&gt;  values      :      poor      1</span>
<span class="co">#&gt;                     poor      1</span>
<span class="co">#&gt;                     poor      1</span></code></pre>
<p>You will notice that the <code>details</code> parameter is present above. This returns the output <code>outRaster</code>, the <code>$lookUp</code> table associated with the strata, and the polygon (<code>$poly</code>) created to drive the stratification based on attribute and features provided by the users.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="strat_map">
<code>strat_map</code><a class="anchor" aria-label="anchor" href="#strat_map"></a>
</h2>
<p>There may be an instance where multiple levels of stratification are desired. For instance a user may want to combine the output from <code><a href="../reference/strat_poly.html">strat_poly()</a></code> above with 3 classes, with the 4 class kmeans stratification <code>kmeans</code>.</p>
<p>The total number of classes will always be the multiplicative of the number of strata. i.e. if <code>sraster</code> has 3 strata and <code>sraster2</code> has 4 strata the output of <code><a href="../reference/strat_map.html">strat_map()</a></code> will be 12 strata total.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--- map srasters ---#</span>
<span class="fu"><a href="../reference/strat_map.html">strat_map</a></span><span class="op">(</span>sraster <span class="op">=</span> <span class="va">srasterpoly</span>, <span class="co"># strat_poly 3 class stratification</span>
          sraster2 <span class="op">=</span> <span class="va">sraster</span>, <span class="co"># strat_kmeans 4 class stratification</span>
          plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="stratification_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<pre><code><span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 277, 373, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 20, 20  (x, y)</span>
<span class="co">#&gt; extent      : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; name        : strata </span>
<span class="co">#&gt; min value   :     11 </span>
<span class="co">#&gt; max value   :     34</span></code></pre>
<p>The convention for the numeric value of output strata is the concatenation (merging) of sraster strata and sraster2 strata. See <code>$lookUp</code> for a clear depiction of this.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/strat_map.html">strat_map</a></span><span class="op">(</span>sraster <span class="op">=</span> <span class="va">srasterpoly</span>, <span class="co"># strat_poly 3 class stratification</span>
          sraster2 <span class="op">=</span> <span class="va">sraster</span>, <span class="co"># strat_poly 3 class stratification</span>
          stack <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># stack input and oputput strata into multi layer ouput raster</span>
          details <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># provide additional details</span>
          plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># plot output</span>
<span class="co">#&gt; Stacking sraster, sraster2, and their combination (stratamapped).</span></code></pre></div>
<p><img src="stratification_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<pre><code><span class="co">#&gt; $outRaster</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 277, 373, 3  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 20, 20  (x, y)</span>
<span class="co">#&gt; extent      : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; sources     : memory  </span>
<span class="co">#&gt;               memory  </span>
<span class="co">#&gt;               memory  </span>
<span class="co">#&gt; names       : strata, strata2, stratamapped </span>
<span class="co">#&gt; min values  :      1,       1,           11 </span>
<span class="co">#&gt; max values  :      3,       4,           34 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $lookUp</span>
<span class="co">#&gt;    strata strata2 stratamapped</span>
<span class="co">#&gt; 1       3       1           31</span>
<span class="co">#&gt; 2       3       4           34</span>
<span class="co">#&gt; 3       1       2           12</span>
<span class="co">#&gt; 4       1       3           13</span>
<span class="co">#&gt; 5       3       2           32</span>
<span class="co">#&gt; 6       3       3           33</span>
<span class="co">#&gt; 7       1       1           11</span>
<span class="co">#&gt; 8       1       4           14</span>
<span class="co">#&gt; 9       2       1           21</span>
<span class="co">#&gt; 10      2       2           22</span>
<span class="co">#&gt; 11      2       4           24</span>
<span class="co">#&gt; 12      2       3           23</span></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://scholar.google.ca/citations?user=C_qdYDsAAAAJ&amp;hl=en" class="external-link">Tristan RH Goodbody</a>, <a href="https://forestry.ubc.ca/faculty-profile/nicholas-coops/" class="external-link">Nicholas C Coops</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.9000.9000.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
